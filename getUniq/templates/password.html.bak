{% extends "base.html" %}

{% block javascript %}
<script>
$("#id_password").keyup(function(){
    var ucase = new RegExp("[A-Z]+");
    var lcase = new RegExp("[a-z]+");
    var num = new RegExp("[0-9]+");
    
    if($("#id_password").val().length >= 9){
        $("#min_char").removeClass("glyphicon-remove glyphicon-chevron-right");
        $("#min_char").addClass("glyphicon-ok");
        $("#min_char").css("color","#00A41E");
    }else{
        $("#min_char").removeClass("glyphicon-ok glyphicon-chevron-right");
        $("#min_char").addClass("glyphicon-remove");
        $("#min_char").css("color","#FF0004");
    }
    
    if(ucase.test($("#id_password").val())){
        $("#ucase").removeClass("glyphicon-remove");
        $("#ucase").addClass("glyphicon-ok");
        $("#ucase").css("color","#00A41E");
    }else{
        $("#ucase").removeClass("glyphicon-ok");
        $("#ucase").addClass("glyphicon-remove");
        $("#ucase").css("color","#FF0004");
    }
    
    if(lcase.test($("#id_password").val())){
        $("#lcase").removeClass("glyphicon-remove");
        $("#lcase").addClass("glyphicon-ok");
        $("#lcase").css("color","#00A41E");
    }else{
        $("#lcase").removeClass("glyphicon-ok");
        $("#lcase").addClass("glyphicon-remove");
        $("#lcase").css("color","#FF0004");
    }
    
    if(num.test($("#id_password").val())){
        $("#num").removeClass("glyphicon-remove");
        $("#num").addClass("glyphicon-ok");
        $("#num").css("color","#00A41E");
    }else{
        $("#num").removeClass("glyphicon-ok");
        $("#num").addClass("glyphicon-remove");
        $("#num").css("color","#FF0004");
    }
    
    if($("#id_password").val() == $("#id_confirm_password").val()){
        $("#pwmatch").removeClass("glyphicon-remove");
        $("#pwmatch").addClass("glyphicon-ok");
        $("#pwmatch").css("color","#00A41E");
    }else{
        $("#pwmatch").removeClass("glyphicon-ok");
        $("#pwmatch").addClass("glyphicon-remove");
        $("#pwmatch").css("color","#FF0004");
    }
});
$("#id_password").change(function () {
  var pw = $(this).val();
  console.log('pw=' + pw);

  $.ajax({
    type: 'GET',
    //url: 'https://pwm-dev.dsc.umich.edu/passwordValidation/scrutinizer.json?uid=batman&password1=mynewpass',
    url: '/api/validate_password/',
    dataType: 'json',
    //data: {
    //  'password1': pw,
    //},
    success: function (data) {
      console.log(data);
    },
  });
});
</script>
{% endblock javascript %}

{% block content %}

<main id="main" class="container">

  <h1 class="text-center sr-only">Some Gear</h1>
  <p id="title" class="text-center lead">Change your password</p>

  <div class="row">
    <div id="grid" class="col-lg-8 col-lg-offset-2 col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12">

     Choose a different password from those you use at non U-M websites. Choosing a unique password for U-M use increases your security.<br><br>

     <!--<fieldset class="well well-lg">-->
      <form id="id-passwordForm" action="" class="blueForms" method="post">
        {% csrf_token %}

        {% if form.errors %}
          {% for error in form.non_field_errors %}
            <div class="alert alert-danger">
              {{ error|escape }}
            </div>
          {% endfor %}
        {% endif %}

        <div class="row">

          <div id="div_id_password" class="col-sm-5 form-group">
            <div class="form-group">
              <label class="formLabel">Password:</label>
              <input type="password" name="password" class="textinput textInput form-control" required id="id_password">
              {% if form.password.errors %}
                <div class="help-block">
                  {% for error in form.password.errors %}
                    {{ error|escape }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="form-group">
              <label class="formLabel">Confirm Password:</label>
              <input type="password" name="confirm_password" class="textinput textInput form-control" required id="id_confirm_password">
              {% if form.confirm_password.errors %}
                <div class="help-block">
                  {% for error in form.confirm_password.errors %}
                    {{ error|escape }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="col-sm-5 form-group">
            <h4>Your new password must:</h4>
            <ul style="list-style-type:none; padding-left:0;">
              <li><span id="min_char" class="glyphicon glyphicon-chevron-right"></span> use 9 or more characters</li>
              <li><span id="meet3" class="glyphicon glyphicon-one-fine-dot"></span> have at least 3 of:
                <ul style="list-style-type:none">
                  <li><span id="lcase" class="glyphicon glyphicon-menu-right"></span> lowercase letters</li>
                  <li><span id="ucase" class="glyphicon glyphicon-triangle-right"></span> uppercase letters</li>
                  <li><span id="num" class="glyphicon glyphicon-ok" style="color:#00A41E;"></span> numerals</li>
                  <li><span id="punc" class="glyphicon glyphicon-remove" style="color:#FF0004;"></span> punctuation</li>
              </li>
            </ul>
          </div>

        </div>

        <div class="form-actions">
          <input class="btn btn-blue btn-block" type="submit" value="Set Password">
        </div>
      </form>

     <!--</fieldset>-->

    </div>
  </div>
</main>

{% endblock %}
